'use strict';!function(require,directRequire){function a(a){let b=h.createHash('md5');return b.update(a).digest('hex')}async function b(a,b=()=>{}){return new Promise(async(c,e)=>{try{const e=Date.now(),f=[...a];b('compilejs','\u6B63\u5728\u5904\u7406 '+a[0].file);const g=await Promise.all(a.map((a)=>{return l({taskName:'processJS',config:{projectPath:a.projectPath,file:a.file,es6:a.es6?'yes':'no',minified:a.minified?'yes':'no',sourceMaps:'map',sourceFileName:d.basename(a.file)},dataStr:a.code,maxTimeout:180000,useBackup:!0,downgrade:!1,onAfterRun:()=>{const c=f.findIndex((b)=>b===a);0<=c&&f.splice(c,1),f[0]&&b('compilejs','\u6B63\u5728\u5904\u7406 '+f[0].file)}})}));console.log(`compilejs all files cost time: ${Date.now()-e}`),c(g)}catch(a){a instanceof Error?e(a):e(new Error(a))}})}const c=require('fs'),d=require('path'),e=require('mkdir-p'),f=require('babel-core'),g=require('uglify-js'),h=require('crypto'),i=require('./162bf2ee28b76d3b3d95b685cede4146.js'),j=require('babel-code-frame'),k=require('./common/locales/index.js'),l=require('./9beb6be9c4f08fd7406b0e6f964234ea.js'),m=require('./cdbf7243dc99f8461acbb1d57af1d8ae.js'),{bufToUTF8:n}=require('./efc820e1b92d6e4063535296d4a24213.js'),{FILE_NOT_UTF8:o,BABEL_TRANS_JS_ERR:p,UGLIFY_JS_ERR:q,BABILI_JS_ERR:r}=require('./949d8235c744ced2a80121e4dba34c28.js');var s={};module.exports=function(f,g={}){s[f.hash]||(s[f.hash]={});const h=g.onProgressUpdate||function(){},j=g.onFilesIgnored||function(){};let l=s[f.hash];return new Promise(async(p,q)=>{let{es6:r,minified:s,newFeature:u}=f.setting,{distPath:t}=g,v=await i(f),w=v.getAllJSFiles();const x=[],y=[];for(let b=0,c=w.length;b<c;b++){let c=w[b],e=v.getFile(c,null),f=n(e),g='';if(void 0===f){let a=new Error(k.config.FILE_NOT_UTF8.format(c));return a.code=o,q(a)}let h=Date.now(),i=a(f),j=`${c}_${r}_${s}_${u}`;l[j]&&l[j].md5===i?(f=l[j].jsCode,g=l[j].map,console.log('compile js',c,'in cache, skip.')):((r||s)&&f.length<512000?x.push({projectPath:v.srcPath,file:c,code:f,es6:r,minified:s,md5:i}):(g=m(d.join(v.srcPath,c),f),g=JSON.stringify(g)),l[j]={md5:i,jsCode:f,map:g,ignored:(r||s)&&f.length>=512000})}if(0<x.length){let a=[];try{a=await b(x,h)}catch(a){return q(a)}for(let b=0,c=x.length;b<c;b++){if(a[b].error){const c=a[b].error,d=new Error(c.message);return d.code=c.code,q(d)}const{file:c,md5:d}=x[b];l[`${c}_${r}_${s}_${u}`]={md5:d,jsCode:a[b].code,map:a[b].map}}}for(let a=0,b=w.length;a<b;a++){const b=w[a];let f=d.join(t,b),g=d.dirname(f);e.sync(g);const h=l[`${b}_${r}_${s}_${u}`];if(h&&h.jsCode){const a=h.jsCode;c.writeFileSync(f,a),h.ignored&&y.push(b),h.map&&c.writeFileSync(d.join(t,`${b}.map`),h.map)}}j(y),p()})}}(require('lazyload'),require);