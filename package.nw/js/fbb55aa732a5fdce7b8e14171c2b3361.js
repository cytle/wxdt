'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){async function a(a,b,c){return new Promise((e)=>{a({type:i.SIMULATOR_SET_AUTHORIZE_CONFIRM,data:{show:!0,scopeList:c.scopeList,imageUrl:c.imageUrl,appName:c.appName,callback:async(a,c)=>{a=a&&c[0].checked;let{body:g}=await d({url:`${f.jsOperateWXDATAURL}`,method:'post',body:JSON.stringify({data:JSON.stringify(b.args.data||{}),grant_scope:c[0].scope,opt:a?1:2}),needToken:1,needAppID:1});return a?e({errMsg:`${b.api}:ok`,data:JSON.parse(g.data)}):e({errMsg:`${b.api}:fail auth deny`})}}})})}async function b(a,b,c){return new Promise((e)=>{a({type:i.SIMULATOR_SET_AUTHORIZE_CONFIRM,data:_extends({},c,{show:!0,callback:async(a,c)=>{let g=[];c.forEach((a)=>{!a.checked||g.push(a.scope)});let{body:h}=await d({url:`${f.jsAuthorizeConfirmURL}`,method:'post',body:JSON.stringify({scope:g,opt:a?1:2}),needToken:1,needAppID:1});return h.baseresponse&&0===h.baseresponse.errcode?void(a?e({errMsg:`${b.api}:ok`}):e({errMsg:`${b.api}:fail auth deny`})):void e({errMsg:`${b.api}:fail`})}})})})}async function c(){for(;1&&!(1>l.length);){const a=l[0];if(!a)break;try{const b=await a.fn();a.resolve(b)}catch(b){a.reject(b)}l.shift()}}const d=require('./15ba1827c7f6564a45df6bd44da3a977.js'),e=require('./3bfffbe88b3d923921f851c0697974fe.js'),f=require('./f171257bbcaef547a3cf27266ccb0db2.js'),g=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),h=require('./df6d0ff021a69fb541c733de4dbba0fe.js'),i=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),{enterBackground:j,enterForeground:k}=require('./a3959bb900db9f65ed2e9c5dfa6977b7.js');let l=[];module.exports={login:async function(a,b){let{body:c}=await d({url:`${f.jsLoginURL}`,method:'post',body:JSON.stringify({scope:['snsapi_base']}),needToken:1,needAppID:1});return{errMsg:`${b.api}:ok`,code:c.code}},refreshSession:async function(a,b){let{body:c}=await d({url:`${f.jsRefreshSessionURL}`,method:'post',needToken:1,needAppID:1});return{errMsg:`${b.api}:ok`,expireIn:c.session_expire_in,err_code:c.baseresponse.errcode}},operateWXData:async function(b,c){'webapi_getuserinfo'==c.args.data.api_name&&1003000>e.getLibVersionNumber()&&(delete c.args.data.lang,delete c.args.data.with_credentials);let{body:j}=await d({url:`${f.jsOperateWXDATAURL}`,method:'post',body:JSON.stringify({data:JSON.stringify(c.args.data||{})}),needToken:1,needAppID:1,needCheckErrCode:-1}),k=j.baseresponse;if(k){let d=j.baseresponse.errcode;if(0==d){let a=JSON.parse(j.data);try{let d=c.args&&c.args.data&&c.args.data.api_name&&c.args.data.api_name.replace('webapi_','')||c.api;b({type:i.SIMULATOR_UPDATE_DECRYPTED_INFO,api:d,data:{encryptedData:a.encryptedData,iv:a.iv,sessionKey:j.debug_info.session_key,decryptedData:j.debug_info.data}})}catch(a){}return{errMsg:`${c.api}:ok`,data:a}}if(d==h.NEED_CONFORM)return await a(b,c,{imageUrl:j.appicon_url,appName:j.appname,scopeList:[j.scope]});let e=g.parseCgiErrorCode(d,k.errmsg);return{errMsg:`${c.api}:fail ${e}`}}},authorize:async function(a,e){let{body:i}=await d({url:`${f.jsAuthorizeURL}`,method:'post',body:JSON.stringify({scope:e.args.scope||[]}),needCheckErrCode:-1,needToken:1,needAppID:1}),j=i.baseresponse;if(j){let d=j.errcode;if(0==d)return{errMsg:`${e.api}:ok`,body:i};if(d==h.NEED_CONFORM)return await(async()=>new Promise((d,f)=>{l.push({fn:async()=>{return await b(a,e,{imageUrl:i.appicon_url,appName:i.appname,scopeList:i.scope_list})},resolve:d,reject:f}),2>l.length&&c()}))();let f=g.parseCgiErrorCode(d,j.errmsg);return{errMsg:`${e.api}:fail ${f}`}}return{errMsg:`${e.api}:fail system error`}},openWeRunSetting:async function(a,b){let{body:c}=await d({url:`${f.checkWeRunState}`,method:'post',body:JSON.stringify({appid:e.getProjectAppID()}),needToken:1,needAppID:1}),g=c.state;if(1==g)return{errMsg:`${b.api}:ok`};let h=c.wording||'\u7528\u6237\u672A\u5F00\u542F\u5FAE\u4FE1\u8FD0\u52A8\uFF0C\u8BF7\u5728\u5FAE\u4FE1\u5BA2\u6237\u7AEF\u5F00\u542F';return a({type:i.SIMULATOR_SET_CONFIRM,data:{show:!0,content:h,showCancel:!1,confirmText:'\u5173\u95ED'}}),{errMsg:`${b.api}:fail ${h}`}},chooseInvoiceTitle:async function(a,b){a({type:i.SIMULATOR_SET_CHOOSEINVOICETITLE,data:{show:!0,callbackID:b.callbackID,api:b.api}})},addPhoneContact:async function(a,b){a({type:i.SIMULATOR_SET_ADDPHONECONTACT,data:{show:!0,callbackID:b.callbackID,api:b.api,contactData:_extends({},b.args)}})},openAddress:async function(a,b){a({type:i.SIMULATOR_SET_CHOOSEADDRESS,data:{show:!0,callbackID:b.callbackID,api:b.api}})}}}(require('lazyload'),require);