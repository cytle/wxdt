'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){const a=require('fs'),b=require('path'),c=require('mkdir-p'),d=require('glob'),e=require('lodash'),f=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),g=require('./f171257bbcaef547a3cf27266ccb0db2.js'),h=require('./15ba1827c7f6564a45df6bd44da3a977.js'),i=require('./72653d4b93cdd7443296229431a7aa9a.js'),j=require('./3bfffbe88b3d923921f851c0697974fe.js'),k=require('./d28a711224425b00101635efe1034c99.js'),l=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),m=require('./a8c87029da0fa06e986298d447ab0fe2.js'),n=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),o=require('./df6d0ff021a69fb541c733de4dbba0fe.js'),p=require('./da7c31daaf542cf1796023d8e344b98a.js'),q=require('./common/locales/index.js'),r=require('./42191d95974f14b18961c9f2c730464e.js'),s=require('./1fcc6bd55b687d154a4247e57fe3011d.js'),t=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),u=require('./eb1fe4da47d7ed10884f8b039b058c5b.js'),v=require('./9ebfd1a4a241684455002e8c6d889fd7.js'),w=require('./881e653f19d837f2408386047cb8c38c.js'),x=require('./b543ae2da406cea63b3ad8951f17b6c0.js'),{default_weapp_header:y}=require('./5498e660c05c574f739a28bd5d202cfa.js'),z='darwin'===process.platform,A=(a,b)=>{if(!a)return!1;b=_extends({},b||{});const c=['setting','compileType','condiction','libVersion','appid','projectname','svr','client','qcloudRoot','miniprogramRoot','isGameTourist'];for(let d in b)b.hasOwnProperty(d)&&0>c.findIndex((a)=>a===d)&&delete b[d];const d=r.generateConfigTemplate(),e=_extends({},d,{setting:a.setting,compileType:a.compileType,condiction:a.condiction,libVersion:a.libVersion,appid:a.appid,projectname:a.projectname,svr:a.svr,client:a.client,qcloudRoot:a.qcloudRoot,miniprogramRoot:a.miniprogramRoot},b),f=r.writeObjectToConfigFile(a,e);return!f.error},B=(a,b,c)=>(d)=>{return'parseerror'===a?void d(s.setConfirmInfo({show:!0,showCancel:!0,title:'',content:'project.config.json \u6587\u4EF6\u53EF\u80FD\u635F\u574F\u3002\u662F\u5426\u91CD\u65B0\u521B\u5EFA\u6B64\u6587\u4EF6\uFF1F',callback(a){a&&A(b,c)}})):void A(b,c)},C=(a)=>(b,c)=>{const d=c();if(!a){if(a=d.project.current,!a)return;a.accessTime=+new Date,n.updateProject(a.projectid,a),b({type:f.PROJECT_UPDATE_LIST,list:_extends({},d.project.list,{[a.projectid]:a})})}else a.accessTime=+new Date,n.updateProject(a.projectid,a),b({type:f.PROJECT_UPDATE_LIST,list:_extends({},d.project.list,{[a.projectid]:a})})},D=(a)=>Object.prototype.toString.call(a).toLowerCase().slice(8,-1),E=(a,b,c,d)=>{return D(b)===c?d?0<=d.findIndex((a)=>a===b)?b:a:b:a};module.exports={selectDevType:(a)=>(b,c)=>{if(a!==l.DEV_TYPE.MP_WEB)try{const a=c().project.list;0<Object.keys(a).length?b(m.setMainWindow(l.MAIN_WINDOW_TYPE.SELECT_PROJECT)):b(m.setMainWindow(l.MAIN_WINDOW_TYPE.CREATE_PROJECT))}catch(a){b(m.setMainWindow(l.MAIN_WINDOW_TYPE.SELECT_PROJECT))}else u.openWebDebugger(),n.lastSelect=l.MAIN_WINDOW_TYPE.WEB_DEBUGGER,p('url_open')},selectProjectRequest:()=>{return{type:f.PROJECT_SELECT_PROJECT_REQUEST}},selectProjectCancel:()=>{return{type:f.PROJECT_SELECT_PROJECT_CANCEL}},selectProjectOpen:()=>()=>{v.selectProjectOpen()},selectProjectClose:()=>{return{type:f.PROJECT_SELECT_PROJECT_CLOSE}},createProjectRequest:()=>{return{type:f.PROJECT_CREATE_PROJECT_REQUEST}},createProjectSuccess:(g,{initQuickStart:h=!1,quickstartHost:k=''}={})=>(m)=>{const n=e.merge(j.projectConfigDefault(g),g);if(h){let e,f=g.projectpath;e=h===l.QUICKSTART_TYPE.WEAPP?'weapp':h===l.QUICKSTART_TYPE.QCLOUD_NODEJS?'node':h===l.QUICKSTART_TYPE.QCLOUD_PHP?'php':h===l.QUICKSTART_TYPE.PLUGIN?'plugin':h===l.QUICKSTART_TYPE.GAME?'game':'weapp';let j=global.appConfig.isDev?b.join(__dirname,'../../vendor/quickstart',e):b.join(__dirname,'./vendor/quickstart',e);try{let e=d.sync(`./**/**`,{cwd:j});if(e.forEach((d)=>{let e=b.join(j,d),g=b.join(f,d),h=a.lstatSync(e);if(h.isDirectory())c.sync(g);else{let b=a.readFileSync(e);a.writeFileSync(g,b)}}),h===l.QUICKSTART_TYPE.QCLOUD_NODEJS){let c=b.join(f,'./server/config.js'),d=a.readFileSync(c,'utf8');if(a.writeFileSync(c,d.replace(`appId: '',`,`appId: '${n.appid}',`).replace(`pass: '',`,`pass: '${n.appid}',`),'utf8'),k){let c=b.join(f,'./client/config.js'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace(`host = 'https://123456.qcloud.la'`,`host = '${k}'`),'utf8')}}else if(h===l.QUICKSTART_TYPE.QCLOUD_PHP){let c=b.join(f,'./server/config.php'),d=a.readFileSync(c,'utf8');if(a.writeFileSync(c,d.replace(`'appId' => '',`,`'appId' => '${n.appid}',`).replace(`'pass' => '',`,`'pass' => '${n.appid}',`),'utf8'),k){let c=b.join(f,'./client/config.js'),d=a.readFileSync(c,'utf8');a.writeFileSync(c,d.replace(`host = 'https://123456.qcloud.la'`,`host = '${k}'`),'utf8')}}}catch(a){i.error(`project.actions.js initProject error ${a.toString()}`)}}const o=r.getConfigFileInfo(g);if(!o.error){const a=_extends({},o.config,{appid:n.appid,projectname:n.projectname});g.isGameTourist&&(a.setting.urlCheck=!1),r.writeObjectToConfigFile(g,a)}else A(g,n);m({type:f.PROJECT_CREATE_PROJECT_SUCCESS,project:n}),m(C(n))},createProjectFail:(a)=>{return{type:f.PROJECT_CREATE_PROJECT_FAIL,err:a}},createProjectCancel:()=>(a,b)=>{b();try{const c=b().project.list;0<Object.keys(c).length?a(m.setMainWindow(l.MAIN_WINDOW_TYPE.SELECT_PROJECT)):a(m.setMainWindow(l.MAIN_WINDOW_TYPE.ENTRANCE))}catch(b){a(m.setMainWindow(l.MAIN_WINDOW_TYPE.SELECT_PROJECT))}},createProjectOpen:()=>()=>{v.createProjectOpen()},createProjectClose:()=>{return{type:f.PROJECT_CREATE_PROJECT_CLOSE}},removeProject:(a)=>(b)=>{n.removeProject(a),x.closeDevWindow(a),b({type:f.PROJECT_REMOVE_PROJECT,id:a})},openProject:(a)=>(b)=>new Promise(async(c,d)=>{try{const d=n.projectList;d[a]||i.error(`open project with unknown projectid ${a}`);const e=d[a];e&&(e.storage={});let{appid:f,projectname:g,projectpath:h}=e;h=encodeURIComponent(h),u.openMiniProgram({appid:f,projectname:g,projectpath:h}),c(),b(C()),n.lastSelect=a,p('project_open',e.appid)}catch(a){d(a)}}),closeProject:()=>(a,b)=>{const c=b();c.window.remoteDebugWindow.debuggingProjectId===c.project.current.projectid&&a(m.setRemoteDebugWindow({show:!1,debuggingProjectId:null})),w.notifyCloseWindow(!0),nw.Window.get().close(!0)},requestProjectAttr:()=>(a)=>new Promise(async(b)=>{let c=j.getCurrent();if(!(c&&c.isTourist))try{const d=await j.getLatestProjectAttr();a({type:f.PROJECT_UPDATE_ATTR,data:d}),a({type:f.SIMULATOR_SET_GROUP_INFO,data:{list:d.share_info}}),a(C(c)),b()}catch(d){i.error(`requestProjectAttr catch error ${d}`),d===q.config.CGI_ERR_NOT_BAND?a({type:f.PROJECT_UPDATE_ATTR,data:{userbanded:!1},project:c}):(d===q.config.CGI_ERR_PLATFORM_INVALID_EXT_APPID||d===q.config.CGI_ERR_PLATFORM_EXT_APPID_NOT_AUTH)&&a({type:f.PROJECT_SET_EXT_INFO,data:{errMsg:d}}),b(d)}}),setCompileCondiction:(a)=>(b)=>{b({type:f.PROJECT_SET_COMPILE_CONDICTION,data:a});const c=j.getCurrent(),d=c.compileType,e=r.getConfigFileInfo(c),g=[...c.condiction[d].list];if(e.error)b(B(e.error.type,c,{condiction:_extends({},c.condiction,{[d]:_extends({},c.condiction[d],{list:g})})}));else{const a=_extends({},e.config,{condiction:_extends({},c.condiction,e.config.condiction||{},{[d]:_extends({},c.condiction[d],{list:g})})});r.writeObjectToConfigFile(c,a)}b(C())},removeCompileCondiction:(a)=>(b)=>{b({type:f.PROJECT_REMOVE_COMPILE_CONDICTION,data:a});const c=j.getCurrent(),d=c.compileType,e=r.getConfigFileInfo(c),g=[...c.condiction[d].list];if(e.error)b(B(e.error.type,c,{condiction:_extends({},c.condiction,{[d]:_extends({},c.condiction[d],{list:g})})}));else{const a=_extends({},e.config,{condiction:_extends({},c.condiction,e.config.condiction||{},{[d]:_extends({},c.condiction[d],{list:g})})});r.writeObjectToConfigFile(c,a)}b(C())},setProjectSetting:(a)=>(b)=>{const c=j.getCurrent();b({type:f.PROJECT_SET_SETTING,data:a});const d=r.getConfigFileInfo(c);if(d.error)b(B(d.error.type,c,{setting:_extends({},c.setting,a)}));else{const b=_extends({},d.config,{setting:_extends({},c.setting,d.config.setting||{},a)});r.writeObjectToConfigFile(c,b)}b(C())},selectCompileCondiction:(a)=>(b)=>{b({type:f.PROJECT_SELECT_COMPILE_CONDICTION,current:a});const c=j.getCurrent(),d=c.compileType,e=r.getConfigFileInfo(c);if(e.error)b(B(e.error.type,c,{condiction:_extends({},c.condiction,{[d]:_extends({},c.condiction[d],{current:a})})}));else{const b=_extends({},e.config,{condiction:_extends({},c.condiction,e.config.condiction||{},{[d]:_extends({},c.condiction[d],{current:a})})});r.writeObjectToConfigFile(c,b)}b(C())},setProjectLibVersion:(a)=>(b)=>{k.setVersion(a),b({type:f.PROJECT_SET_LIBVERSION,data:a});const c=j.getCurrent(),d=r.getConfigFileInfo(c);if(d.error)b(B(d.error.type,c,{libVersion:a}));else{const b=_extends({},d.config,{libVersion:a});r.writeObjectToConfigFile(c,b)}b(C())},checkUploadStatus:()=>{let a=j.getCurrent();return(b)=>{h({url:`${g.uploadQrCodeURL}?appid=${a.appid}`,method:'get',needToken:1}).then(({resp:a,body:c})=>{let d=1===c.is_experience?'\u4E0A\u6B21\u63D0\u4EA4\u5DF2\u88AB\u9009\u4E3A\u4F53\u9A8C\u7248\uFF0C\u672C\u6B21\u4E0A\u4F20\u5C06\u4F1A\u8986\u76D6\u4F53\u9A8C\u7248\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F':'\u4E0A\u4F20\u6210\u529F\u540E\uFF0C\u9700\u8981\u8054\u7CFB\u7BA1\u7406\u5458\u5728\u5C0F\u7A0B\u5E8F\u7BA1\u7406\u540E\u53F0\u5C06\u672C\u6B21\u4E0A\u4F20\u8BBE\u7F6E\u4E3A\u4F53\u9A8C\u7248\u672C\u3002';b({type:f.INFO_SET_UPLOAD,data:{status:1,wording:d}})}).catch((a)=>{b({type:f.INFO_SET_UPLOAD,data:{show:!1}}),b({type:f.INFO_SHOW_ERROR,data:{message:a.toString()}})})}},setProjectCompileType:(a)=>{return(b)=>{b({type:f.PROJECT_SET_COMPILE_TYPE,data:a});const c=j.getCurrent(),d=r.getConfigFileInfo(c);if(d.error)b(B(d.error.type,c,{compileType:a}));else{const b=_extends({},d.config,{compileType:a});r.writeObjectToConfigFile(c,b)}b(C())}},setProjectQCloud:(a)=>{return{type:f.PROJECT_SET_QCLOUD,data:a}},setPkgSize:(a)=>(b)=>{b({type:f.PROJECT_SET_PKG_SIZE,data:a}),b(C())},setProjectConfig:(a)=>(b)=>{const c=j.getCurrent();a.setting=a.setting||{},a.condiction=a.condiction||{},a.condiction.weapp=a.condiction.weapp||{},a.condiction.weapp.list=E([...c.condiction.weapp.list],a.condiction.weapp.list,'array'),a.condiction.search=a.condiction.search||{},a.condiction.search.list=E([...c.condiction.search.list],a.condiction.search.list,'array'),a.condiction.conversation=a.condiction.conversation||{},a.condiction.conversation.list=E([...c.condiction.conversation.list],a.condiction.conversation.list,'array'),a.condiction.game=a.condiction.game||{},a.condiction.game.list=E([...c.condiction.game.list],a.condiction.game.list,'array');const d=[];for(let c of a.condiction.weapp.list)c&&'number'===D(c.id)&&'string'===D(c.name)&&'string'===D(c.pathName)&&d.push({id:c.id,name:c.name,pathName:c.pathName,query:E('',c.query,'string'),scene:c.scene,shareInfo:E(void 0,c.shareInfo,'object'),referrerInfo:E(void 0,c.referrerInfo,'object')});const e=[];for(let c of a.condiction.search.list)c&&'number'===D(c.id)&&'string'===D(c.name)&&e.push({id:c.id,name:c.name,widgetData:E('',c.widgetData,'string'),service:E(void 0,c.service,'object'),query:E('',c.query,'string'),customQuery:E('',c.customQuery,'string'),boxQI:E('',c.boxQI,'string'),debugUrl:E('',c.debugUrl,'string')});const g=[];for(let c of a.condiction.conversation.list)c&&'number'===D(c.id)&&'string'===D(c.name)&&g.push({id:c.id,name:c.name,pathName:E(void 0,c.pathName,'string'),title:E(void 0,c.title,'string'),cachekey:E(void 0,c.cachekey,'string')});const h=[];for(let c of a.condiction.game.list)c&&'number'===D(c.id)&&'string'===D(c.name)&&h.push({id:c.id,name:c.name,query:E('',c.query,'string'),scene:c.scene});const i=k.getVendorConfig(),l={setting:{urlCheck:E(c.setting.urlCheck,a.setting.urlCheck,'boolean'),es6:E(c.setting.es6,a.setting.es6,'boolean'),postcss:E(c.setting.postcss,a.setting.postcss,'boolean'),minified:E(c.setting.minified,a.setting.minified,'boolean'),newFeature:E(c.setting.newFeature,a.setting.newFeature,'boolean')},compileType:E(c.compileType,a.compileType,'string',['weapp','search','conversation']),condiction:{weapp:{current:E(c.condiction.weapp.current,a.condiction.weapp.current,'number'),list:[...d]},search:{current:E(c.condiction.search.current,a.condiction.search.current,'number'),list:[...e]},conversation:{current:E(c.condiction.conversation.current,a.condiction.conversation.current,'number'),list:[...g]},game:{current:E(c.condiction.game.current,a.condiction.game.current,'number'),list:[...h]}},libVersion:E(c.libVersion,a.libVersion,'string',Object.keys(i.libs)),svr:E(c.svr,a.svr||'','string'),client:E(c.client,a.client||'','string'),qcloudRoot:E(c.qcloudRoot,a.qcloudRoot||'','string'),miniprogramRoot:E(c.miniprogramRoot,a.miniprogramRoot||'','string')};!l.qcloudRoot&&l.svr&&(l.qcloudRoot=l.svr),!l.miniprogramRoot&&l.client&&(l.miniprogramRoot=l.client),l.libVersion!==c.libVersion&&k.setVersion(l.libVersion),b({type:f.PROJECT_SET_PROJECT_CONFIG,data:JSON.parse(JSON.stringify(l))}),b(C())},setProjectExtInfo:(a)=>{return{type:f.PROJECT_SET_EXT_INFO,data:a}},saveUploadInfo:(a)=>(b)=>{b({type:f.PROJECT_SET_UPLOAD_INFO,data:a}),b(C())},updateProjectCover:(a)=>(b,c)=>{let d=a.project;if(!d){const b=c();if(d=b.project.current,!d)return;n.setProjectCover(d.projectid,a.image)}else n.setProjectCover(d.projectid,a.image)},openTempProject:(a)=>()=>{let{appid:b,projectname:c,projectpath:d}=a;c=encodeURIComponent(c),d=encodeURIComponent(d),u.openTempOnlineMiniProgram({appid:b,projectname:c,projectpath:d})},syncProject:(a,b)=>{return{type:f.PROJECT_SYNC_STORE,data:a,syncTime:b}}}}(require('lazyload'),require);