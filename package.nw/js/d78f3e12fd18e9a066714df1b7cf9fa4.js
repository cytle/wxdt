'use strict';!function(require,directRequire){const a=require('fs'),b=require('path'),c=require('http'),d=require('request'),e=require('./72653d4b93cdd7443296229431a7aa9a.js'),f=require('./74af8a23ddee45c6c1265c88746b66bc.js'),g=require('./c74067b2c1f476fa940f6315c56fb29e.js'),h=require('./84b183688a46c9e2626d3e6f83365e13.js'),i=require('./881e653f19d837f2408386047cb8c38c.js');module.exports={start:(j,k)=>new Promise((l,m)=>{try{e.info(`start cli server, local port ${j}, cli client port ${k||'undefined'}`);const m=c.createServer(f.userRequestHandler);m.listen(j,'127.0.0.1');const n=nw.App.getDataPath();if(global.isDevWindow?(i.notifyCliPortUpdate(j),a.writeFileSync(b.join(n,`.ide-${global.devInfo.appid}-${global.devInfo.projectname}`),j,'utf8')):a.writeFileSync(b.join(n,'.ide'),j,'utf8'),!global.isDevWindow)if(k)d({url:`http://127.0.0.1:${k}/updatePort?port=${j}`},(a)=>{a&&e.error('fail to notify remote cli program:',a)}),d({url:`http://127.0.0.1:${k}/wechatdevtools/${encodeURIComponent(nw.App.manifest.name)}/updateport/${j}`},(a)=>{a&&(e.error('fail to notify remote driver program:',a),global.CLI.isTestMode&&(e.error('quit ide...'),h.quit()))});else try{k=parseInt(a.readFileSync(b.join(n,'.cli'),'utf8')),d({url:`${'http://127.0.0.1'}:${k}/updatePort?port=${j}`,timeout:2e3},(a)=>{a?e.info(`no cli client started`):g.updateRemoteCLIPort(k)})}catch(a){e.info(`no cli client started`)}l()}catch(a){m(a)}})}}(require('lazyload'),require);