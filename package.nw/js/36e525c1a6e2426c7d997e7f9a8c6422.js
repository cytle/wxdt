'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){const a=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),b=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),c=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),d=require('./78294f0b5b50fc38258d7028553744ef.js'),e=require('./36244f5aa8a25574083d64e28953b466.js'),f=require('./5eb00762b104199e0cf0af7efbe591da.js'),g=require('./5719b6ded53098ffd9e848abcac30153.js'),h=require('./da7c31daaf542cf1796023d8e344b98a.js'),i=require('./84b183688a46c9e2626d3e6f83365e13.js'),j='darwin'===process.platform,k=(a,b={})=>new Promise(async(c,h)=>{try{if(b.isTemp){let d;try{d=await f.getAppInfo(b.appid,b)}catch(a){h(a)}const g=_extends({},b,{projectpath:a,projectname:`temp_${+new Date}`}),i=`${b.appid}_${g.projectname}`;g.compileType=d.game_app?'game':'weapp',await e.openProject(d,g,a,b),c(i)}else{let i;if(i=d.checkProjectPath(a),i.error)return h(i.error);let k;if(i=d.checkProjectConfigJSON(a),i.error)return h(i.error);if(k=i.config,!k.appid||!k.projectname)return h(g.ERROR.NOT_FOUND_IN_PROJECT_CONFIG_JSON(k.appid?'projectname':'appid'));const l=`${k.appid}_${k.projectname}`;if(e.isOpened(l,a)){process.stderr.write('isopened\n');const a=global.windowMap.get('MAIN');if(a)return a.show(),j||(a.setAlwaysOnTop(!0),setTimeout(()=>{a.setAlwaysOnTop(!1)},20)),setTimeout(()=>{e.openSimulatorAndDebugger(),e.compile()},20),void c(l)}let m;try{m=await f.getAppInfo(k.appid,b)}catch(a){h(a)}await e.openProject(m,k,a,b),c(l)}}catch(a){h(g.ERROR.GENERIC_ERROR(a.toString()))}});module.exports={registerHandlers:(c)=>{c.get('/open',async(c,d)=>{try{global.Win.showFunction&&(global.Win.show=global.Win.showFunction);const e=a.getState();if(e.window.mainWindow!==b.MAIN_WINDOW_TYPE.DEV&&e.window.mainWindow!==b.MAIN_WINDOW_TYPE.WEB_DEBUGGER)j?global.Win.show():global.Win.focus();else{const a=global.windowMap.get('MAIN');a&&(j?a.show():a.focus())}let f=c.mQuery.projectpath;const g=decodeURIComponent(c.mQuery.cli||''),i=decodeURIComponent(c.mQuery.from||'');g?f?h('cli_open_project',null,null,i?{engine_from:i}:null):h('cli_open_ide',null,null,i?{engine_from:i}:null):f?h('http_open_project',null,null,i?{engine_from:i}:null):h('http_open_ide',null,null,i?{engine_from:i}:null),f&&(f=decodeURIComponent(f),await k(f)),d.statusCode=200,d.end()}catch(a){d.statusCode=400,d.end(a.toString(),'utf8')}}),c.get('/quit',async(a,b)=>{b.statusCode=200,b.end(),i.quit()})},openProject:k}}(require('lazyload'),require);