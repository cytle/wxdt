'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){function a(){i.info(`IDE is going to suicide because the inactive time has exceeded ${r/1e3/60} minutes`),j.quit()}const b=require('request'),c=require('./8f5981105740200e87abfc379e4a36f6.js'),d=require('./8201c9f7be7447a385da48a3a5af0d42.js'),e=require('./b4fb47d5f3cee5536f111697f701f083.js'),f=require('./15da66bcecf19293a1e4cee6d641ac07.js'),g=require('./c016c015550b8c8e4a79e8e85062bd17.js'),h=require('./205e69607c4b60711b15f5ac95b40ce4.js'),i=require('./72653d4b93cdd7443296229431a7aa9a.js'),j=require('./84b183688a46c9e2626d3e6f83365e13.js'),k=require('./d6d995f6e6beb0243444faa9fc9669c5.js'),l=require('./b543ae2da406cea63b3ad8951f17b6c0.js'),m=require('./881e653f19d837f2408386047cb8c38c.js'),n=require('./09060286633d09fb81fefc8ff1294dd7.js'),o='REDIRECT_TO_CURRENT_BROWSING_CONTEXT',p='REDIRECT_TO_MAIN_SVR_WINDOW';let q,r=3600000;const s=_extends({},c,d,e,f),t=[g.Name.GET,g.Name.QUIT].reduce((a,b)=>{return a[b]=!0,a},{}),u=async(a,b)=>{let c=null;try{c=g.parse(a.method,a.url)}catch(b){return`unknown command: ${a.url}`}if(!c)return`unknown command: ${a.url}`;const d=c.getName();if(s[d]){if(h.getSelfWindowHandle()!==h.getCurrentBrowsingContext()){if(h.getSelfWindowHandle()!==h.getMainWindowHandle())return p;if(!t[d])return o}let a={};try{a=JSON.parse(b)}catch(a){}return await s[d](c,a)}return`unknown command: ${a.url}`},v=(b,c)=>{global.CLI.isTestMode&&(clearTimeout(q),q=setTimeout(a,r));let d;(function(a){var c=[];b.on('data',function(a){c.push(a)}),b.on('end',function(){d=Buffer.concat(c),a()})})(async()=>{try{let a=await u(b,d);if(a===o){const a=l.clientWindows.get(h.getCurrentBrowsingContext()).cliPort,d=b.headers.host.replace(/\:\d+$/,()=>{return':'+a}),e={Location:`http://${d}${b.url}`};c.writeHead(307,e),c.end()}else if(a===p){const a=m.serverWindowInfo.get(n.CLI_PORT),d=b.headers.host.replace(/\:\d+$/,()=>{return':'+a}),e={Location:`http://${d}${b.url}`};c.writeHead(307,e),c.end()}else{let b='object'==typeof a?JSON.stringify(a):a.toString(),d={"Content-Type":'object'==typeof a?'application/json':'text/plain'};c.writeHead(200,d),c.end(b)}}catch(a){i.error(`process driver command error: ${a}`);c.writeHead(500,{"Content-Type":'text/plain'}),c.end(a.toString())}})};v.init=()=>{global.CLI.isTestMode&&(clearTimeout(q),q=setTimeout(a,r))},module.exports=v}(require('lazyload'),require);